<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monitoreo de Red</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class'
    };
  </script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Estilos personalizados -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/temas.css') }}">
  <script src="{{ url_for('static', filename='js/tema.js') }}" defer></script>

  <style>
    .table-container {
      max-height: 600px;
      overflow-y: auto;
      position: relative;
    }
    #mensajeEstado {
      font-size: 1.2rem;
      font-weight: bold;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
    }
    .dark .table-container table {
      background-color: #1f2937;
      color: #f3f4f6;
    }
    body {
      transition: background-color 0.3s, color 0.3s;
    }
  </style>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white flex font-sans transition-colors duration-300">
  
  <!-- PANEL LATERAL -->
  <aside class="w-64 bg-gray-900 text-white flex flex-col min-h-screen">
    <div class="p-4 text-center text-2xl font-bold border-b border-gray-700">游댏 IDS System</div>
    <nav class="flex-1 p-4 space-y-2 text-sm">
      <a href="{{ url_for('login.dashboard') }}" class="flex items-center space-x-2 p-2 hover:bg-gray-800 rounded {{ 'bg-gray-800 shadow-md' if request.endpoint == 'login.dashboard' else '' }}">
        <i data-lucide="layout-dashboard" class="w-5 h-5"></i><span>Panel principal</span>
      </a>
      <a href="{{ url_for('login.usuario') }}" class="flex items-center space-x-2 p-2 hover:bg-gray-800 rounded {{ 'bg-gray-800 shadow-md' if request.endpoint == 'login.usuario' else '' }}">
        <i data-lucide="users" class="w-5 h-5"></i><span>Usuarios</span>
      </a>
      <a href="{{ url_for('login.perfil') }}" class="flex items-center space-x-2 p-2 hover:bg-gray-800 rounded {{ 'bg-gray-800 shadow-md' if request.endpoint == 'login.perfil' else '' }}">
        <i data-lucide="shield" class="w-5 h-5"></i><span>Perfiles</span>
      </a>
      <a href="{{ url_for('dispositivos.dispositivos') }}" class="flex items-center space-x-2 p-2 hover:bg-gray-800 rounded {{ 'bg-gray-800 shadow-md' if request.endpoint == 'dispositivos.dispositivos' else '' }}">
        <i data-lucide="server" class="w-5 h-5"></i><span>Dispositivos</span>
      </a>
      <a href="{{ url_for('login.monitoreo') }}" class="flex items-center space-x-2 p-2 hover:bg-gray-800 rounded {{ 'bg-gray-800 shadow-md' if request.endpoint == 'login.monitoreo' else '' }}">
        <i data-lucide="rss" class="w-5 h-5"></i><span>Monitoreo</span>
      </a>
      <a href="{{ url_for('login.alertas') }}" class="flex items-center space-x-2 p-2 hover:bg-gray-800 rounded {{ 'bg-gray-800 shadow-md' if request.endpoint == 'login.alertas' else '' }}">
        <i data-lucide="alert-triangle" class="w-5 h-5"></i><span>Alertas</span>
      </a>
      <a href="#" class="flex items-center space-x-2 p-2 hover:bg-gray-800 rounded">
        <i data-lucide="search" class="w-5 h-5"></i><span>Eventos</span>
      </a>
      <a href="#" class="flex items-center space-x-2 p-2 hover:bg-gray-800 rounded">
        <i data-lucide="bar-chart" class="w-5 h-5"></i><span>Reportes</span>
      </a>
      <a href="#" class="flex items-center space-x-2 p-2 hover:bg-gray-800 rounded">
        <i data-lucide="settings" class="w-5 h-5"></i><span>Configuraci칩n</span>
      </a>
      <a href="#" class="flex items-center space-x-2 p-2 hover:bg-gray-800 rounded">
        <i data-lucide="log-out" class="w-5 h-5"></i><span>Cerrar Sesi칩n</span>
      </a>
    </nav>
  </aside>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="flex-1 p-6">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-5xl font-extrabold text-indigo-700 dark:text-indigo-300">Monitoreo de Red</h1>
      <button id="temaSwitch" class="flex items-center transition duration-300 ease-in-out bg-gray-800 text-white px-4 py-2 rounded shadow hover:bg-gray-700">
        游깿 Tema Oscuro
      </button>
    </div>

    <div class="flex justify-center mb-6 gap-4">
      <button id="btnIniciar" class="bg-green-500 text-white px-4 py-2 rounded">郊윒잺 Iniciar Captura</button>
      <button id="btnDetener" class="bg-red-500 text-white px-4 py-2 rounded opacity-50 cursor-not-allowed" disabled>游띔 Detener Captura</button>
      <button id="btnRegresar" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300">Regresar al Panel</button>
    </div>

    <p id="mensajeEstado" class="mt-4 font-semibold text-lg"></p>

    <div class="flex justify-center mb-6">
      <input type="text" id="buscador" placeholder="Buscar..." class="p-3 border border-gray-300 rounded-lg w-1/2 shadow-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
    </div>

    <div class="table-container bg-white dark:bg-gray-800 dark:text-white p-6 rounded-lg shadow-lg overflow-auto">
      <table class="w-full text-sm text-left border-collapse">
        <thead class="bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-200 uppercase text-xs font-semibold">
          <tr>
            <th class="p-3">ID</th>
            <th class="p-3">IP Origen</th>
            <th class="p-3">IP Destino</th>
            <th class="p-3">MAC Origen</th>
            <th class="p-3">MAC Destino</th>
            <th class="p-3">Puerto Origen</th>
            <th class="p-3">Puerto Destino</th>
            <th class="p-3">Protocolo</th>
            <th class="p-3">Tama침o</th>
            <th class="p-3">Fecha Captura</th>
            <th class="p-3">TTL</th>
          </tr>
        </thead>
        <tbody id="packetTable" class="text-center bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
          {% for p in paquetes %}
          <tr>
            <td class="p-2">{{ p[0] or 'N/A' }}</td>
            <td class="p-2">{{ p[1] or 'N/A' }}</td>
            <td class="p-2">{{ p[2] or 'N/A' }}</td>
            <td class="p-2">{{ p[3] or 'N/A' }}</td>
            <td class="p-2">{{ p[4] or 'N/A' }}</td>
            <td class="p-2">{{ p[5] or 'N/A' }}</td>
            <td class="p-2">{{ p[6] or 'N/A' }}</td>
            <td class="p-2">{{ p[7] or 'N/A' }}</td>
            <td class="p-2">{{ p[8] or 'N/A' }}</td>
            <td class="p-2">{{ p[9] or 'N/A' }}</td>
            <td class="p-2">{{ p[10] or 'N/A' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
      <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
        <h3 class="text-lg font-semibold text-indigo-700 dark:text-indigo-300 mb-3">游늳 Tr치fico en Tiempo Real</h3>
        <canvas id="trafficChart"></canvas>
      </div>
      <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
        <h3 class="text-lg font-semibold text-indigo-700 dark:text-indigo-300 mb-3">游댌 Protocolos Detectados</h3>
        <canvas id="protocolChart"></canvas>
      </div>
    </div>
  </main>

  <!-- Script principal -->
  <script src="{{ url_for('static', filename='js/monitoreo.js') }}"></script>
  <script>
    lucide.createIcons();
  </script>
</body>
</html>
